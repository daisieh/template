function accordion_init(t){t?accordion_new(t):document.readyState&&"complete"!==document.readyState?window.addEvent("load",function(){accordion_new(0)}):accordion_new(0)}function accordion_new(t){return new Fx.Accordion($$(".panel-heading"),$$(".panel-body"),{alwaysHide:!0,opacity:!1,show:t})}function c_(t){for(;t&&t.getAttribute;){var e=t.getAttribute("id");if(e&&"string"==typeof e&&"c_"===e.substring(0,2))return $(t);t=t.parentNode}return!1}function c_ancestor(t,e){for(;t&&t.getAttribute;){var i=t.getAttribute("id");if(i&&"string"==typeof i&&"c_"===i.substring(0,2))return!1;if(t.tagName===e)return t;t=t.parentNode}return!1}function cb_set_all(t,e,i){for(var n=t.elements,s=0;s<n.length;s++)(e&&n[s].className===e||!e&&"checkbox"===n[s].type)&&(n[s].checked=i)}function code_mirror(t,e,i){var n=$(t);if(!n.getNext()||!n.getNext().hasClass("CodeMirror")){var s=["search","undo","redo","jump","reindentSelection","reindent"],o={mode:e?e:"xml"},l={buttons:s,path:context+"/codemirror-3.21/",searchMode:"popup"};return i&&(s.push("save"),l.save_func=function(){submit_form(t)}),new CodeMirrorUI(n,l,o)}}function comment_popup(t,e,i){t.firstChild?t.getFirst().retrieve("object").show():(d=new Dropdown(t,!0),d.add("Edit",function(){return new Dialog({url:context+"/"+e+"/"+i+"/edit",title:"Edit Comment",dialog_class:"news_item_dialog",e:t,cancel:"Cancel"}),!1}),d.add("Delete",function(){dialog_confirm("Delete this comment?",function(){XHR_post(context+"/"+e+"/"+i+"/delete",null,function(){t.getParent("div.comment").dispose()})})}),d.show())}function cookie_get(t){var e=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");return e?unescape(e[1]):!1}function cookie_set(t,e,i){if(i){var n=new Date;n.setTime(n.getTime()+31536e6),document.cookie=t+"="+e+";expires="+n.toGMTString()}else document.cookie=t+"="+e}function delrecform(rn,t,id,e){dialog_confirm("Delete this "+rn.toLowerCase()+"?",function(){var url="db_cmd=delete&db_view_def="+t+"&db_key_value="+id+"&form=true";XHR_post(context+"/db",url,function(js){eval(js)}.bind(e))})}function delrectable(rn,u,t,id,e,o){dialog_confirm((u?"Unlink ":"Delete ")+" this "+rn.toLowerCase()+"?",function(){var data="db_cmd=delete&db_view_def="+t+"&db_key_value="+id;o&&(data+="&db_one_from="+o),XHR_post(context+"/db",data,function(t){t&&eval(t),c_(e).replace(null,{top:document.getScroll().y})})})}function ec_toggle(t){var e=t.src.lastIndexOf("/")+1,i="expand.gif"===t.src.substr(e);return t.src=t.src.substr(0,e)+(i?"collapse.gif":"expand.gif"),i}function expand_collapse(t,e,i){for(var n=document.getElementsByName(e),s=ec_toggle(t.firstChild),o=0;o<n.length;o++)n.item(o).style.display=s?"":"none"}function fade_alert(t,e){e.style.display="none";var i=new Element("span").set("text",t).setStyle("background-color","yellow");i.inject(e,"after"),new Fx.Morph(i,{duration:2e3,onComplete:function(){i.dispose(),e.style.display=""}}).start({opacity:0})}function fill_choice(t,e){var i=t.value.length,n=t.value.toLowerCase();if(i>0)for(var s=e.getChildren(),o=0;o<s.length;o++){var l=s[o].getFirst().get("text");if(l.substring(0,i).toLowerCase()===n){if(l.length>i)if(t.value=l,t.setSelectionRange)t.focus(),t.setSelectionRange(i,l.length);else if(t.createTextRange){var r=t.createTextRange();r.collapse(!0),r.moveEnd("character",l.length),r.moveStart("character",i),r.select()}break}}}function go_add(t,e,i,n,s,o,l){var r=c_ancestor(t,"FORM");if(r){if(!validate_form(r))return;return r.db_add_relationship.value=i,void submit_form(r,{validate:!0})}var a=context+"/Views/"+e+"?db_mode=ADD_FORM&db_relationship="+i;s?new Dialog({component:!0,owner:o,rte:l,url:a}):$(c_(t)).push(a,n)}function makeExpandingArea(t){var e=t.getElement("textarea"),i=t.getElement("pre");i.setStyle("font-size",e.getStyle("font-size")),i.setStyle("padding-left",e.getStyle("padding-left")),i.setStyle("padding-top",e.getStyle("padding-top")),i.setStyle("padding-right",e.getStyle("padding-right")),i.setStyle("padding-bottom",e.getStyle("padding-bottom"));var n=t.getElement("span");e.addEventListener?(e.addEventListener("input",function(){n.textContent=e.value},!1),n.textContent=e.value):e.attachEvent&&(e.attachEvent("onpropertychange",function(){n.innerText=e.value}),n.innerText=e.value),t.className+=" active",e.addEvent("focus",function(){t.setStyle("max-height","none")})}function new_select(t,e){var i=document.createElement("SELECT");i.name=t;for(var n=0;n<e.length;n++)i.options[n]=new Option(e[n]);return i}function rich_text(t,e){rich_text_remove(),$(t).getParent().setStyle("color","black"),rich_text_element=$(t),JS.get("/ckeditor/ckeditor",function(){rich_text_editor=CKEDITOR.replace(rich_text_element,e)})}function rich_text_remove(t){if(rich_text_editor){if(t&&!t.contains(rich_text_editor.container.$))return;rich_text_editor.destroy(),rich_text_editor=null,rich_text_element=null}}function send_form(t,e){for(var i=$(t).ancestor("FORM"),n=i.elements,s=0;s<n.length;s++)n[s]===rich_text_element&&rich_text_editor.updateElement();i.set("send",{onSuccess:e}),i.send()}function set_theme(t){var e=document.getElementsByTagName("link").item(0),i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",context+"/themes/"+t+"/"+t+".css"),document.getElementsByTagName("head").item(0).replaceChild(i,e),$("theme_"+cookie_get("theme")).removeClass("disabled"),$("theme_"+t).addClass("disabled"),cookie_set("theme",t,!0)}function submit_form(s,options){var f=$(s).ancestor("FORM");return options&&options.validate&&!validate_form(f)?!1:(s.setStyle("visibility","hidden"),f.db_submit_id&&(f.db_submit_id.value=s.get("id")),new iframe(f,function(t){s.setStyle("visibility","");try{var o=JSON.parse(t);if(o.error)return void dialog_alert("error",o.error)}catch(e){}var o=c_(f);o&&o.stack&&(o.stack[o.stack.length-1].url=o.stack[o.stack.length-1].url.replace("&db_mode=ADD_FORM","&db_mode=EDIT_FORM")),o&&o.getParent(".modal")&&(o.url=o.url.replace("&db_mode=ADD_FORM","&db_mode=EDIT_FORM")),t?eval(t):options&&options.onComplete&&options.onComplete(t)}),!1)}function validate_form(t){for(var e=t.elements,i=0;i<e.length;i++){if(e[i]===rich_text_element&&rich_text_editor.updateElement(),e[i].validate&&!e[i].validate())return!1;if(e[i].getAttribute("required")){var n=null;if("SELECT"===e[i].tagName)n=e[i].options[e[i].selectedIndex].text;else if("INPUT"===e[i].tagName&&"radio"===e[i].type){for(var s=!1,o=e[i];o;){if("INPUT"===o.tagName&&o.checked){s=!0;break}o=o.nextSibling}if(s)continue}else n=e[i].value;if(!n||""===n)return dialog_alert("Required Field",'Please enter a value for "'+e[i].getAttribute("title")+'"'),e[i].focus(),!1}}return!0}function write_crumbs(t){var e=$(t+"_crumbs");$(c_(e)).write_crumbs(e)}function XHR_get(t,e){Element.hidePopups(),new Request({url:t,method:"get",onSuccess:e}).send()}function XHR_post(t,e,i){new Request({url:t,method:"post",data:e,onSuccess:i}).send()}function dialog_alert(t,e){var i=new Dialog({title:t,ok:!0});i.body.set("text",e),i.open()}function dialog_confirm(t,e){var i=new Dialog({ok:{click:function(){e(),i.close()}},cancel:!0});i.body.set("text",t),i.open()}MooTools.More={version:"1.5.1",build:"2dd695ba957196ae4b0275a690765d6636a61ccd"};var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,preventDefault:!1,stopPropagation:!1,compensateScroll:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var t=Array.link(arguments,{options:Type.isObject,element:function(t){return null!=t}});this.element=document.id(t.element),this.document=this.element.getDocument(),this.setOptions(t.options||{});var e=typeOf(this.options.handle);this.handles=("array"==e||"collection"==e?$$(this.options.handle):document.id(this.options.handle))||this.element,this.mouse={now:{},pos:{}},this.value={start:{},now:{}},this.offsetParent=function(t){var e=t.getOffsetParent(),i=!e||/^(?:body|html)$/i.test(e.tagName);return i?window:document.id(e)}(this.element),this.selection="selectstart"in document?"selectstart":"mousedown",this.compensateScroll={start:{},diff:{},last:{}},!("ondragstart"in document)||"FileReader"in window||Drag.ondragstartFixed||(document.ondragstart=Function.from(!1),Drag.ondragstartFixed=!0),this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(!1),scrollListener:this.scrollListener.bind(this)},this.attach()},attach:function(){return this.handles.addEvent("mousedown",this.bound.start),this.options.compensateScroll&&this.offsetParent.addEvent("scroll",this.bound.scrollListener),this},detach:function(){return this.handles.removeEvent("mousedown",this.bound.start),this.options.compensateScroll&&this.offsetParent.removeEvent("scroll",this.bound.scrollListener),this},scrollListener:function(){if(this.mouse.start){var t=this.offsetParent.getScroll();if("absolute"==this.element.getStyle("position")){var e=this.sumValues(t,this.compensateScroll.last,-1);this.mouse.now=this.sumValues(this.mouse.now,e,1)}else this.compensateScroll.diff=this.sumValues(t,this.compensateScroll.start,-1);this.offsetParent!=window&&(this.compensateScroll.diff=this.sumValues(this.compensateScroll.start,t,-1)),this.compensateScroll.last=t,this.render(this.options)}},sumValues:function(t,e,i){var n={},s=this.options;for(z in s.modifiers)s.modifiers[z]&&(n[z]=t[z]+e[z]*i);return n},start:function(t){var e=this.options;if(!t.rightClick){e.preventDefault&&t.preventDefault(),e.stopPropagation&&t.stopPropagation(),this.compensateScroll.start=this.compensateScroll.last=this.offsetParent.getScroll(),this.compensateScroll.diff={x:0,y:0},this.mouse.start=t.page,this.fireEvent("beforeStart",this.element);var i=e.limit;this.limit={x:[],y:[]};var n,s,o=this.offsetParent==window?null:this.offsetParent;for(n in e.modifiers)if(e.modifiers[n]){var l=this.element.getStyle(e.modifiers[n]);if(l&&!l.match(/px$/)&&(s||(s=this.element.getCoordinates(o)),l=s[e.modifiers[n]]),this.value.now[n]=e.style?(l||0).toInt():this.element[e.modifiers[n]],e.invert&&(this.value.now[n]*=-1),this.mouse.pos[n]=t.page[n]-this.value.now[n],i&&i[n])for(var r=2;r--;){var a=i[n][r];(a||0===a)&&(this.limit[n][r]="function"==typeof a?a():a)}}"number"==typeOf(this.options.grid)&&(this.options.grid={x:this.options.grid,y:this.options.grid});var h={mousemove:this.bound.check,mouseup:this.bound.cancel};h[this.selection]=this.bound.eventStop,this.document.addEvents(h)}},check:function(t){this.options.preventDefault&&t.preventDefault();var e=Math.round(Math.sqrt(Math.pow(t.page.x-this.mouse.start.x,2)+Math.pow(t.page.y-this.mouse.start.y,2)));e>this.options.snap&&(this.cancel(),this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop}),this.fireEvent("start",[this.element,t]).fireEvent("snap",this.element))},drag:function(t){var e=this.options;e.preventDefault&&t.preventDefault(),this.mouse.now=this.sumValues(t.page,this.compensateScroll.diff,-1),this.render(e),this.fireEvent("drag",[this.element,t])},render:function(t){for(var e in t.modifiers)t.modifiers[e]&&(this.value.now[e]=this.mouse.now[e]-this.mouse.pos[e],t.invert&&(this.value.now[e]*=-1),t.limit&&this.limit[e]&&((this.limit[e][1]||0===this.limit[e][1])&&this.value.now[e]>this.limit[e][1]?this.value.now[e]=this.limit[e][1]:(this.limit[e][0]||0===this.limit[e][0])&&this.value.now[e]<this.limit[e][0]&&(this.value.now[e]=this.limit[e][0])),t.grid[e]&&(this.value.now[e]-=(this.value.now[e]-(this.limit[e][0]||0))%t.grid[e]),t.style?this.element.setStyle(t.modifiers[e],this.value.now[e]+t.unit):this.element[t.modifiers[e]]=this.value.now[e])},cancel:function(t){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel}),t&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(t){var e={mousemove:this.bound.drag,mouseup:this.bound.stop};e[this.selection]=this.bound.eventStop,this.document.removeEvents(e),this.mouse.start=null,t&&this.fireEvent("complete",[this.element,t])}});Element.implement({makeResizable:function(t){var e=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},t));return this.store("resizer",e),e.addEvent("drag",function(){this.fireEvent("resize",e)}.bind(this))}}),Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(t,e){if(this.parent(t,e),t=this.element,this.droppables=$$(this.options.droppables),this.setContainer(this.options.container),this.options.style){if("left"==this.options.modifiers.x&&"top"==this.options.modifiers.y){var i=t.getOffsetParent(),n=t.getStyles("left","top");!i||"auto"!=n.left&&"auto"!=n.top||t.setPosition(t.getPosition(i))}"static"==t.getStyle("position")&&t.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0),this.overed=null},setContainer:function(t){this.container=document.id(t),this.container&&"element"!=typeOf(this.container)&&(this.container=document.id(this.container.getDocument().body))},start:function(t){this.container&&(this.options.limit=this.calculateLimit()),this.options.precalculate&&(this.positions=this.droppables.map(function(t){return t.getCoordinates()})),this.parent(t)},calculateLimit:function(){var t=this.element,e=this.container,i=document.id(t.getOffsetParent())||document.body,n=e.getCoordinates(i),s={},o={},l={},r={},a={},h=i.getScroll();["top","right","bottom","left"].each(function(n){s[n]=t.getStyle("margin-"+n).toInt(),o[n]=t.getStyle("border-"+n).toInt(),l[n]=e.getStyle("margin-"+n).toInt(),r[n]=e.getStyle("border-"+n).toInt(),a[n]=i.getStyle("padding-"+n).toInt()},this);var c=t.offsetWidth+s.left+s.right,d=t.offsetHeight+s.top+s.bottom,u=0+h.x,p=0+h.y,m=n.right-r.right-c+h.x,f=n.bottom-r.bottom-d+h.y;if(this.options.includeMargins?(u+=s.left,p+=s.top):(m+=s.right,f+=s.bottom),"relative"==t.getStyle("position")){var g=t.getCoordinates(i);g.left-=t.getStyle("left").toInt(),g.top-=t.getStyle("top").toInt(),u-=g.left,p-=g.top,"relative"!=e.getStyle("position")&&(u+=r.left,p+=r.top),m+=s.left-g.left,f+=s.top-g.top,e!=i&&(u+=l.left+a.left,!a.left&&0>u&&(u=0),p+=i==document.body?0:l.top+a.top,!a.top&&0>p&&(p=0))}else u-=s.left,p-=s.top,e!=i&&(u+=n.left+r.left,p+=n.top+r.top);return{x:[u,m],y:[p,f]}},getDroppableCoordinates:function(t){var e=t.getCoordinates();if("fixed"==t.getStyle("position")){var i=window.getScroll();e.left+=i.x,e.right+=i.x,e.top+=i.y,e.bottom+=i.y}return e},checkDroppables:function(){var t=this.droppables.filter(function(t,e){t=this.positions?this.positions[e]:this.getDroppableCoordinates(t);var i=this.mouse.now;return i.x>t.left&&i.x<t.right&&i.y<t.bottom&&i.y>t.top},this).getLast();this.overed!=t&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),t&&this.fireEvent("enter",[this.element,t]),this.overed=t)},drag:function(t){this.parent(t),this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(t){return this.checkDroppables(),this.fireEvent("drop",[this.element,this.overed,t]),this.overed=null,this.parent(t)}}),Element.implement({makeDraggable:function(t){var e=new Drag.Move(this,t);return this.store("dragger",e),e}});var Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{},unDraggableTags:["button","input","a","textarea","select","option"]},initialize:function(t,e){this.setOptions(e),this.elements=[],this.lists=[],this.idle=!0,this.addLists($$(document.id(t)||t)),this.options.clone||(this.options.revert=!1),this.options.revert&&(this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){return this.addLists(this.lists),this},detach:function(){return this.lists=this.removeLists(this.lists),this},addItems:function(){return Array.flatten(arguments).each(function(t){this.elements.push(t);var e=t.retrieve("sortables:start",function(e){this.start.call(this,e,t)}.bind(this));(this.options.handle?t.getElement(this.options.handle)||t:t).addEvent("mousedown",e)},this),this},addLists:function(){return Array.flatten(arguments).each(function(t){this.lists.include(t),this.addItems(t.getChildren())},this),this},removeItems:function(){return $$(Array.flatten(arguments).map(function(t){this.elements.erase(t);var e=t.retrieve("sortables:start");return(this.options.handle?t.getElement(this.options.handle)||t:t).removeEvent("mousedown",e),t},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(t){return this.lists.erase(t),this.removeItems(t.getChildren()),t},this))},getDroppableCoordinates:function(t){var e=t.getOffsetParent(),i=t.getPosition(e),n={w:window.getScroll(),offsetParent:e.getScroll()};return i.x+=n.offsetParent.x,i.y+=n.offsetParent.y,"fixed"==e.getStyle("position")&&(i.x-=n.w.x,i.y-=n.w.y),i},getClone:function(t,e){if(!this.options.clone)return new Element(e.tagName).inject(document.body);if("function"==typeOf(this.options.clone))return this.options.clone.call(this,t,e,this.list);var i=e.clone(!0).setStyles({margin:0,position:"absolute",visibility:"hidden",width:e.getStyle("width")}).addEvent("mousedown",function(t){e.fireEvent("mousedown",t)});return i.get("html").test("radio")&&i.getElements("input[type=radio]").each(function(t,i){t.set("name","clone_"+i),t.get("checked")&&e.getElements("input[type=radio]")[i].set("checked",!0)}),i.inject(this.list).setPosition(this.getDroppableCoordinates(this.element))},getDroppables:function(){var t=this.list.getChildren().erase(this.clone).erase(this.element);return this.options.constrain||t.append(this.lists).erase(this.list),t},insert:function(t,e){var i="inside";this.lists.contains(e)?(this.list=e,this.drag.droppables=this.getDroppables()):i=this.element.getAllPrevious().contains(e)?"before":"after",this.element.inject(e,i),this.fireEvent("sort",[this.element,this.clone])},start:function(t,e){!this.idle||t.rightClick||!this.options.handle&&this.options.unDraggableTags.contains(t.target.get("tag"))||(this.idle=!1,this.element=e,this.opacity=e.getStyle("opacity"),this.list=e.getParent(),this.clone=this.getClone(t,e),this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){t.stop(),this.clone.setStyle("visibility","visible"),this.element.setStyle("opacity",this.options.opacity||0),this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(t))},end:function(){this.drag.detach(),this.element.setStyle("opacity",this.opacity);var t=this;if(this.effect){var e=this.element.getStyles("width","height"),i=this.clone,n=i.computePosition(this.getDroppableCoordinates(i)),s=function(){this.removeEvent("cancel",s),i.destroy(),t.reset()};this.effect.element=i,this.effect.start({top:n.top,left:n.left,width:e.width,height:e.height,opacity:.25}).addEvent("cancel",s).chain(s)}else this.clone.destroy(),t.reset()},reset:function(){this.idle=!0,this.fireEvent("complete",this.element)},serialize:function(){var t=Array.link(arguments,{modifier:Type.isFunction,index:function(t){return null!=t}}),e=this.lists.map(function(e){return e.getChildren().map(t.modifier||function(t){return t.get("id")},this)},this),i=t.index;return 1==this.lists.length&&(i=0),(i||0===i)&&i>=0&&i<this.lists.length?e[i]:e}});Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(t,e){this.elements=this.subject=$$(t),this.parent(e)},compute:function(t,e,i){var n={};for(var s in t){var o=t[s],l=e[s],r=n[s]={};for(var a in o)r[a]=this.parent(o[a],l[a],i)}return n},set:function(t){for(var e in t)if(this.elements[e]){var i=t[e];for(var n in i)this.render(this.elements[e],n,i[n],this.options.unit)}return this},start:function(t){if(!this.check(t))return this;var e={},i={};for(var n in t)if(this.elements[n]){var s=t[n],o=e[n]={},l=i[n]={};for(var r in s){var a=this.prepare(this.elements[n],r,s[r]);o[r]=a.from,l[r]=a.to}}return this.parent(e,i)}}),Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:!1,fixedWidth:!1,display:0,show:!1,height:!0,width:!1,opacity:!0,alwaysHide:!1,trigger:"click",initialDisplayFx:!0,resetHeight:!0},initialize:function(){var t=function(t){return null!=t},e=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:t,elements:t});this.parent(e.elements,e.options);var i=this.options,n=this.togglers=$$(e.togglers);this.previous=-1,this.internalChain=new Chain,i.alwaysHide&&(this.options.link="chain"),(i.show||0===this.options.show)&&(i.display=!1,this.previous=i.show),i.start&&(i.display=!1,i.show=!1);var s=this.effects={};i.opacity&&(s.opacity="fullOpacity"),i.width&&(s.width=i.fixedWidth?"fullWidth":"offsetWidth"),i.height&&(s.height=i.fixedHeight?"fullHeight":"scrollHeight");for(var o=0,l=n.length;l>o;o++)this.addSection(n[o],this.elements[o]);this.elements.each(function(t,e){if(i.show===e)this.fireEvent("active",[n[e],t]);else for(var o in s)t.setStyle(o,0)},this),(i.display||0===i.display||i.initialDisplayFx===!1)&&this.display(i.display,i.initialDisplayFx),i.fixedHeight!==!1&&(i.resetHeight=!1),this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(t,e){t=document.id(t),e=document.id(e),this.togglers.include(t),this.elements.include(e);var i=this.togglers,n=this.options,s=i.contains(t),o=i.indexOf(t),l=this.display.pass(o,this);if(t.store("accordion:display",l).addEvent(n.trigger,l),n.height&&e.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"}),n.width&&e.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"}),e.fullOpacity=1,n.fixedWidth&&(e.fullWidth=n.fixedWidth),n.fixedHeight&&(e.fullHeight=n.fixedHeight),e.setStyle("overflow","hidden"),!s)for(var r in this.effects)e.setStyle(r,0);return this},removeSection:function(t,e){var i=this.togglers,n=i.indexOf(t),s=this.elements[n],o=function(){i.erase(t),this.elements.erase(s),this.detach(t)}.bind(this);return this.now==n||null!=e?this.display(null!=e?e:n-1>=0?n-1:0).chain(o):o(),this},detach:function(t){var e=function(t){t.removeEvent(this.options.trigger,t.retrieve("accordion:display"))}.bind(this);return t?e(t):this.togglers.each(e),this},display:function(t,e){if(!this.check(t,e))return this;var i={},n=this.elements,s=this.options,o=this.effects;if(null==e&&(e=!0),"element"==typeOf(t)&&(t=n.indexOf(t)),t==this.current&&!s.alwaysHide)return this;if(s.resetHeight){var l=n[this.current];if(l&&!this.selfHidden)for(var r in o)l.setStyle(r,l[o[r]])}return this.timer&&"chain"==s.link||t===this.current&&!s.alwaysHide?this:(null!=this.current&&(this.previous=this.current),this.current=t,this.selfHidden=!1,n.each(function(n,l){i[l]={};var r;l!=t?r=!0:s.alwaysHide&&(n.offsetHeight>0&&s.height||n.offsetWidth>0&&s.width)&&(r=!0,this.selfHidden=!0),this.fireEvent(r?"background":"active",[this.togglers[l],n]);for(var a in o)i[l][a]=r?0:n[o[a]];e||r||!s.resetHeight||(i[l].height="auto")},this),this.internalChain.clearChain(),this.internalChain.chain(function(){if(s.resetHeight&&!this.selfHidden){var e=n[t];e&&e.setStyle("height","auto")}}.bind(this)),e?this.start(i):this.set(i).internalChain.callChain())}}),Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:!1,hideOverflow:!0,resetHeight:!1},initialize:function(t,e){t=this.element=this.subject=document.id(t),this.parent(e),e=this.options;var i=t.retrieve("wrapper"),n=t.getStyles("margin","position","overflow");e.hideOverflow&&(n=Object.append(n,{overflow:"hidden"})),e.wrapper&&(i=document.id(e.wrapper).setStyles(n)),i||(i=new Element("div",{styles:n}).wraps(t)),t.store("wrapper",i).setStyle("margin",0),"visible"==t.getStyle("overflow")&&t.setStyle("overflow","hidden"),this.now=[],this.open=!0,this.wrapper=i,this.addEvent("complete",function(){this.open=0!=i["offset"+this.layout.capitalize()],this.open&&this.options.resetHeight&&i.setStyle("height","")},!0)},vertical:function(){this.margin="margin-top",this.layout="height",this.offset=this.element.offsetHeight},horizontal:function(){this.margin="margin-left",this.layout="width",this.offset=this.element.offsetWidth},set:function(t){return this.element.setStyle(this.margin,t[0]),this.wrapper.setStyle(this.layout,t[1]),this},compute:function(t,e,i){return[0,1].map(function(n){return Fx.compute(t[n],e[n],i)})},start:function(t,e){if(!this.check(t,e))return this;this[e||this.options.mode]();var i,n=this.element.getStyle(this.margin).toInt(),s=this.wrapper.getStyle(this.layout).toInt(),o=[[n,s],[0,this.offset]],l=[[n,s],[-this.offset,0]];switch(t){case"in":i=o;break;case"out":i=l;break;case"toggle":i=0==s?o:l}return this.parent(i[0],i[1])},slideIn:function(t){return this.start("in",t)},slideOut:function(t){return this.start("out",t)},hide:function(t){return this[t||this.options.mode](),this.open=!1,this.set([-this.offset,0])},show:function(t){return this[t||this.options.mode](),this.open=!0,this.set([0,this.offset])},toggle:function(t){return this.start("toggle",t)}}),Element.Properties.slide={set:function(t){return this.get("slide").cancel().setOptions(t),this},get:function(){var t=this.retrieve("slide");return t||(t=new Fx.Slide(this,{link:"cancel"}),this.store("slide",t)),t}},Element.implement({slide:function(t,e){t=t||"toggle";var i,n=this.get("slide");switch(t){case"hide":n.hide(e);break;case"show":n.show(e);break;case"toggle":var s=this.retrieve("slide:flag",n.open);n[s?"slideOut":"slideIn"](e),this.store("slide:flag",!s),i=!0;break;default:n.start(t,e)}return i||this.eliminate("slide:flag"),this}});var Asset={javascript:function(t,e){e||(e={});var i=new Element("script",{src:t,type:"text/javascript"}),n=e.document||document,s=e.onload||e.onLoad;return delete e.onload,delete e.onLoad,delete e.document,s&&(i.addEventListener?i.addEvent("load",s):i.addEvent("readystatechange",function(){["loaded","complete"].contains(this.readyState)&&s.call(this)})),i.set(e).inject(n.head)},css:function(t,e){e||(e={});var i=e.onload||e.onLoad,n=e.document||document,s=e.timeout||3e3;["onload","onLoad","document"].each(function(t){delete e[t]});var o=new Element("link",{type:"text/css",rel:"stylesheet",media:"screen",href:t}).setProperties(e).inject(n.head);if(i){var l=!1,r=0,a=function(){for(var t=document.styleSheets,e=0;e<t.length;e++){var n=t[e],h=n.ownerNode?n.ownerNode:n.owningElement;if(h&&h==o)return l=!0,i.call(o)}return r++,!l&&s/50>r?setTimeout(a,50):void 0};setTimeout(a,0)}return o},image:function(t,e){e||(e={});var i=new Image,n=document.id(i)||new Element("img");return["load","abort","error"].each(function(t){var s="on"+t,o="on"+t.capitalize(),l=e[s]||e[o]||function(){};delete e[o],delete e[s],i[s]=function(){i&&(n.parentNode||(n.width=i.width,n.height=i.height),i=i.onload=i.onabort=i.onerror=null,l.delay(1,n,n),n.fireEvent(t,n,1))}}),i.src=n.src=t,i&&i.complete&&i.onload.delay(1),n.set(e)},images:function(t,e){t=Array.from(t);var i=function(){},n=0;return e=Object.merge({onComplete:i,onProgress:i,onError:i,properties:{}},e),new Elements(t.map(function(i,s){return Asset.image(i,Object.append(e.properties,{onload:function(){n++,e.onProgress.call(this,n,s,i),n==t.length&&e.onComplete()},onerror:function(){n++,e.onError.call(this,n,s,i),n==t.length&&e.onComplete()}}))}))}};Element.implement({addPopup:function(t){this.popups||(this.popups=[]),this.popups[this.popups.length]=t},ancestor:function(t){t=t.toUpperCase();for(var e=this;e.tagName!=t;)e=e.parentNode;return $(e)},ancestorWithClass:function(t){for(var e=this;!e.hasClass(t);)e=e.getParent();return e},disposePopups:function(){if(this.popups)for(;this.popups.length>0;)this.popups.pop().dispose()},dropdown:function(t){Element.hidePopups(),this.setStyle("display","block"),this.removeEvents("mouseleave"),this.addEvent("mouseleave",this.hide),Element.p=this},ensureVisible:function(){var t=this.getPosition().y,e=document.getScroll().y;(e>t||t>e+document.getSize().y)&&window.scrollTo(0,t)},getChild:function(t){for(var e=this.firstChild,i=0;t>i;i++){if(!e)return null;e=e.nextSibling}return $(e)},go:function(t){this.stack[this.stack.length-1].url=t,this.replace(t)},hide:function(){this.style.display="none"},hidePopups:function(){Element.tt&&Element.tt.setStyle("visibility","hidden"),Element.p&&(Element.p.hide(),Element.p.removeEvents("mouseleave"),Element.p.removeEvents("mouseup"),Element.p=null)},isAncestor:function(t){for(t=t.parentNode;t;){if(t===this)return!0;t=t.parentNode}return!1},isClipped:function(){var t=this.getSize(),e=this.getScrollSize();return t.x<e.x||t.y<e.y},moveChildrenTo:function(t){if(t)for(t.removeChildren();this.firstChild;)t.appendChild(this.firstChild)},nodeIndex:function(){for(var t=this,e=0;t.previousSibling;)e++,t=t.previousSibling;return e},pop:function(t){if(this.save)this.save.moveChildrenTo(this),this.save=null;else{t>=this.stack.length&&(t=this.stack.length-1);for(var e=0;t>e;e++)this.stack.pop();this.empty(),this.replace(this.stack[this.stack.length-1].url,{top:this.stack[this.stack.length-1].top})}},popup:function(t,e,i){var n=$(t).getCoordinates(),s=window.getScrollSize().x;this.setStyles({left:n.left+(e?e:0),top:n.top+n.height+(i?i:0),display:"block"}),window.getScrollSize().x>s&&this.setStyle("left",this.getPosition().x-(window.getScrollSize().x-s)),this.removeEvents("mouseleave"),this.addEvent("mouseleave",this.hide),Element.p=this},push:function(t,e,i){i?(this.save=new Element("div"),this.moveChildrenTo(this.save)):this.pushUrl(t,e),this.replace(t)},pushUrl:function(t,e){this.stack||(this.stack=[]),this.stack.length>0&&(this.stack[this.stack.length-1].top=document.getScroll().y),this.stack.push({url:t,crumb:e}),this.url=t},removeChildren:function(){for(;this.firstChild;)this.removeChild(this.firstChild);return this},replace:function(t,e){t?this.url=t:t=this.url,this.replace_options=e,this.disposePopups(),rich_text_remove(this),Element.hidePopups(),new Request.HTML({url:t,method:"get",update:this,onSuccess:function(){e&&e.on_complete&&e.on_complete(),e&&e.top?window.scrollTo(0,e.top):e&&e.ignore||this.ensureVisible()}.bind(this)}).send()},setCrumb:function(t){this.stack[this.stack.length-1].crumb=t},setHTML:function(t){this.innerHTML=this.replace_options&&this.replace_options.to_html?-1!=t.indexOf("</")?t:"<pre>"+t+"</pre>":t},tooltip:function(t,e){Element.tt||(Element.tt=new Element("div").setStyles({position:"absolute",visibility:"hidden",border:"1px solid black",backgroundColor:"lightyellow",padding:1,fontSize:"9pt"}).inject(document.body));var i="r"===e?this.getPosition().x+this.getSize().x:this.getPosition().x,n="r"===e?this.getPosition().y:this.getPosition().y+this.getSize().y;Element.tt.set("html",t).setStyles({top:n,left:i,visibility:"visible"})},writeCrumbs:function(t){for(var e=new Element("ul",{"class":"breadcrumb",styles:{"margin-bottom":0,display:"inline-block"}}),i=0;i<this.stack.length-1;i++){var n=new Element("li").inject(e);new Element("a",{href:"#",text:this.stack[i].crumb,events:{click:new Function("$('"+this.id+"').pop("+(this.stack.length-i-1)+");return false")}}).inject(n)}new Element("li",{"class":"active",text:this.stack[this.stack.length-1].crumb}).inject(e),e.inject(t)}}),document.addEvent("mouseup",function(t){Element.hidePopups()}),document.iframeLoaders={};var iframe=new Class({initialize:function(t,e){this.form=t,this.uniqueId=(new Date).getTime(),document.iframeLoaders[this.uniqueId]=this,this.transport=this.getTransport(),this.on_complete=e,t.target="frame_"+this.uniqueId,t.setAttribute("target","frame_"+this.uniqueId),t.submit()},onStateChange:function(){this.transport=$("frame_"+this.uniqueId);var t=this.transport.contentDocument.documentElement.textContent;t&&(t=t.replace(/&amp;/g,"&")),this.on_complete&&setTimeout(function(){this.on_complete(t)}.bind(this),10)},getTransport:function(){var t=document.createElement("DIV");t.style.position="absolute",t.style.top="0",t.style.marginLeft="-10000px";
var e=document.createElement("iframe");e.setAttribute("name","frame_"+this.uniqueId),e.setAttribute("id","frame_"+this.uniqueId),e.addEventListener("load",function(){this.onStateChange()}.bind(this),!1),t.appendChild(e),document.getElementsByTagName("body").item(0).appendChild(t)}}),rich_text_editor,rich_text_element,Auto=new Class({initialize:function(t,e){this.options=e||{},this.e=$(t),this.div||(this.div=new Element("div").setStyles({backgroundColor:"white",display:"none",position:"absolute",paddingLeft:2,border:"1px solid black"}).inject(document.body)),this.e.auto=this,this.options.noAttach||this.attach(),this.value=this.e.value,this.kp_event=this.keyPress.bind(this),this.ku_event=this.keyUp.bind(this)},attach:function(){this.e.addEvent("keypress",this.kp_event),this.e.addEvent("keyup",this.ku_event)},keyPress:function(t){this.do_update=!1,"enter"===t.key?this.selection>=0&&($(this.div.firstChild).getChild(this.selection).onclick(),t.stop()):63273===t.code?this.select(0,0):63275===t.code?this.select(0,this.div.firstChild.childNodes.length-1):"down"===t.key||63233===t.code?this.select(1):"up"===t.key||63232===t.code?this.select(-1):"esc"===t.key?this.div.hide():this.do_update=!0,this.do_update||t.stop()},keyUp:function(){if(this.do_update)if(this.options.fill)this.options.fill(this.e,this.update.bind(this));else{this.e.empty();for(var t=new Element("ul").setProperty("class","auto"),e=0;e<this.options.texts.length;e++){var i=new Element("li").set("text",this.options.texts[e]);this.options.values?i.addEvent("click",function(){this.e.value=this.options.values[e]}):i.addEvent("click",function(){this.e.value=this.options.texts[e]}),i.injext(t)}t.inject(this.div),this.update()}},release:function(){this.e.removeEvent("keypress",this.kp_event),this.e.removeEvent("keyup",this.ku_event)},select:function(t,e){if(0!=t){if(-1===t&&0===this.selection)return;if(1===t&&this.selection===this.div.firstChild.childNodes.length-1)return;e=this.selection+t}this.selection>=0&&$(this.div.firstChild).getChild(this.selection).setStyle("backgroundColor",null),this.selection=e,$(this.div.firstChild).getChild(this.selection).setStyle("backgroundColor","#b0b0b0")},update:function(t){t&&this.div.set("html",t),this.selection=-1,0===this.div.firstChild.childNodes.length?this.options.limit?(dialog_alert("",'There are no items that contain "'+this.e.value+'"'),this.e.value=this.value,this.keyUp()):this.div.hide():(this.value=this.e.value,"none"===this.div.style.display&&this.div.popup(this.e))}}),Comments={resize:function(){var t=this.comments,e=$(t.firstChild).getCoordinates(t).bottom+20;t.getPosition().y+t.getScroll().y+e+20>window.getSize().y-25&&(e=window.getSize().y-40-t.getPosition().y-t.getScroll().y),t.setStyle("height",e);var i=$$("td.gallery_hilite");i.length?t.scrollTo(0,i[0].getCoordinates(t).bottom):t.scrollTo(0,0),t.fade("in")},scrollToEnd:function(){this.comments.scrollTo(0,this.comments.getScrollSize().y-this.comments.getSize().y+10)}},FileColumnSelect=new Class({initialize:function(t,e,i,n){this.select=t,this.view_def=e,this.column=i,this.options=n||{}},add_files:function(t){t=t.split("/");for(var e=0;e<t.length;e++)this.files_select.options[e]=new Option(t[e])},change:function(){var t=this.select,e=t.getParent(),i=t.options[t.selectedIndex].text;if(rich_text_remove(),e.lastChild!==t.getNext()&&e.removeChild(e.lastChild),"u"===i.charAt(0)){if(new Element("INPUT").setProperties({type:"file",name:this.column}).inject(e),this.options.in_dialog){var n=Dialog.top();delete n.options.rte}}else if("c"===i.charAt(0)){var n=new Element("DIV");n.appendChild(new Element("INPUT").setProperties({type:"hidden",name:this.column}));var s=new Element("TEXTAREA").setProperties({id:"db_"+this.column+"_text",name:"db_"+this.column+"_text",cols:80});if(n.appendChild(s),e.appendChild(n),rich_text("db_"+this.column+"_text"),this.options.in_dialog){var n=Dialog.top();n.options.rte="db_"+this.column+"_text",n.rte.delay(200,n)}}else if("s"===i.charAt(0)&&(this.files_select=new Element("select",{id:this.column,name:this.column,"class":"form-control",styles:{display:"inline",height:"inherit",width:"inherit"}}),e.appendChild(this.files_select),XHR_get(context+"/db?cmd=list_files&db_view_def="+this.view_def+"&column="+this.column+(this.options.dir_column?"&"+this.options.dir_column+"="+this.options.dir:""),this.add_files.bind(this)),this.options.in_dialog)){var n=Dialog.top();delete n.options.rte}}}),Filter=new Class({initialize:function(t,e,i){this.columns=t,this.types=e,this.t=i,this.num_rows=0,JS.get("bool",this.initialize2.bind(this))},initialize2:function(){new Bool(this.t).add_node(!1)},add_row:function(){var t=new_select("columns_"+this.num_rows,this.columns);t.filter=this,t.onchange=function(t){this.filter.on_change(this)},this.p.appendChild(t),this.on_change(t),++this.num_rows},bool:["is true","is false"],on_change:function(t){for(var e=t.selectedIndex,i=t.name.substr(t.name.indexOf("_")+1);t.nextSibling;)t.parentNode.removeChild(t.nextSibling);"text"===this.types[e]?t.parentNode.appendChild(new_select("op_"+i,this.text)):"bool"===this.types[e]&&t.parentNode.appendChild(new_select("op_"+i,this.bool))},text:["is equal to","is not equal to","contains","does not contain"]}),CSS={files:{},get:function(t){var e=context;"/"!==t.charAt(0)&&(e+="/css/"),e+=t,e+=".css";var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e),document.getElementsByTagName("head").item(0).appendChild(i)}},JS={files:{},get:function(t,e){if(JS.src=context,"/"!==t.charAt(0)&&(JS.src+="/js/"),JS.src+=t,JS.src+=".js",JS.files[JS.src]){if("loading"!==JS.files[JS.src])return void(e&&e());setTimeout(function(){JS.get(t,e)},500)}else{JS.files[JS.src]="loading";var i=document.createElement("script");i.type="text/javascript",i.src=JS.src,document.getElementsByTagName("head").item(0).appendChild(i),JS.s=i,JS.f=e,i.onload=JS.onload,i.onreadystatechange=JS.onreadystatechange,JS.onreadystatechange()}},onload:function(){JS.s.onload=null,JS.s.onreadystatechange=null,JS.files[JS.src]="loaded",JS.f&&JS.f()},onreadystatechange:function(){/loaded|complete/i.test(JS.s.readyState)&&JS.onload()}},QuickFilters=new Class({initialize:function(t,e){this.f=t,this.vdn=e;for(var i=0,n=t.length;n>i;i++)$(t[i][0]).addEvent("change",this.send.bind(this))},send:function(){for(var t="",e=0,i=this.f.length;i>e;e++){var n=$(this.f[e][0]),s=n.options[n.selectedIndex],o=s.value?s.value:s.text;"all"!==o&&(t&&(t+=" AND "),t+=this.f[e][1]+("null"===o?" IS NULL":"='"+o+"'"))}XHR_post(context+"/ViewStates/"+this.vdn,"filter="+t,function(){c_(n).replace()})}}),URLBuilder=new Class({initialize:function(t){this.params={};var e=t.indexOf("?");e>0?(this.u=t.substring(0,e),t.substring(e+1).replace(/([^=&]+)=([^&]*)/g,function(t,e,i){this.params[e]=i}.bind(this))):this.u=t},remove:function(t){delete this.params[t]},set:function(t,e){this.params[t]=e},url:function(){var t="";for(var e in this.params)t=(t?t+"&":"")+e+"="+this.params[e];return this.u+(t?"?"+t:"")}});window.addEvent("load",function(){document.body.ondrag=function(){return!1}});var DatePicker=new Class({initialize:function(t,e){this.e=t,this.input=e,this.div=new Element("div",{"class":"dpDiv",styles:{display:"none",position:"absolute",zIndex:1e4}}).inject(document.body)},divider:"/",months:["January","February","March","April","May","June","July","August","September","October","November","December"],button:function(t,e,i){var n=e.getMonth(),s=e.getFullYear();return t?(n+=i,-1===n?(n=11,s--):12===n&&(n=0,s++)):s+=i,new Element("a",{href:"#",events:{click:function(){return this.draw(t,s,n),!1}.bind(this),mouseup:function(t){return t.stop(),!1}},html:"&"+(1===i?"g":"l")+"t"})},choose:function(t){this.input.value=t,this.div.hide()},draw:function(t,e,i){var n=new Date;i>=0&&e>0?n=new Date(e,i,1):(day=n.getDate(),n.setDate(1)),this.div.empty(),(t?this.getMonth(n):this.getYear(e)).inject(this.div)},getMonth:function(t){var e=new Element("table",{"class":"dp"}),i=new Element("tr").inject(e),n=new Element("td").inject(i);this.button(!0,t,-1).inject(n),n=new Element("td",{colspan:5}).inject(i),new Element("a",{events:{click:function(){this.draw(!1,t.getFullYear())}.bind(this),mouseup:function(t){t.stop()}},html:this.months[t.getMonth()]+" "+t.getFullYear()}).inject(n),n=new Element("td").inject(i),this.button(!0,t,1).inject(n),i=new Element("tr").inject(e);for(var s=0;7>s;s++)new Element("td",{"class":"dpDayTD",html:"SMTWTFS".charAt(s)}).inject(i);i=new Element("tr").inject(e);for(var s=0;s<t.getDay();s++)new Element("td",{html:"&nbsp;"}).inject(i);do(function(t,e,n){new Element("td",{"class":t===this.d.getDate()?"dpDateTD":"dpTD",events:{click:function(){this.choose(this.year_first?n+this.divider+e+this.divider+t:e+this.divider+t+this.divider+n)}.bind(this)},html:t}).inject(i)}).bind(this)(t.getDate(),t.getMonth()+1,t.getFullYear()),6===t.getDay()&&(i=new Element("tr").inject(e)),t.setDate(t.getDate()+1);while(t.getDate()>1);if(t.getDay()>0)for(s=6;s>t.getDay();s--)new Element("td",{html:"&nbsp;"}).inject(i);return e},getYear:function(t){var e=new Date(t,1,1),i=new Element("table",{"class":"dp"}),n=new Element("tr").inject(i),s=new Element("td").inject(n);this.button(!1,e,-1).inject(s),s=new Element("td",{colspan:2,html:t}).inject(n),s=new Element("td").inject(n),this.button(!1,e,1).inject(s);for(var o=0;12>o;o++)(function(e){e%4===0&&(n=new Element("tr").inject(i)),s=new Element("td").inject(n),new Element("td",{"class":"dpTD",events:{click:function(){this.draw(!0,t,e)}.bind(this),mouseup:function(t){t.stop()}},html:this.months[e].substr(0,3)}).inject(s)}).bind(this)(o);return i},show:function(){try{var t,e=this.input.value;e.indexOf("/")>=0?t=e.split("/"):e.indexOf("-")>=0&&(t=e.split("-"),this.divider="-"),t?4==t[0].length?(this.d=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2])),this.year_first=!0):this.d=new Date(parseInt(t[2]),parseInt(t[0])-1,parseInt(t[1])):e?this.d=new Date(e):this.d=new Date}catch(i){this.d=new Date}this.div.addEvent("mouseup",function(t){t.stop()}),this.div.popup(this.e),this.draw(!0,this.d.getFullYear(),this.d.getMonth())}}),Dialog=new Class({Implements:Options,options:{cancel:!1,column:null,component:!1,db_key_value:null,db_view_def:null,"delete":null,dialog_class:null,footer:!1,ok:!1,on_close:null,owner:null,reload_page:!1,rte:null,show_close:!0,styles:null,title:null,url:null,width:null},initialize:function(t){this.setOptions(t),Dialog.stack||(Dialog.stack=[]),Dialog.stack.push(this),this.scroll=document.getScroll().y,this.overlay=new Element("div",{"class":"modal-backdrop",styles:{bottom:0,opacity:.5,position:"fixed",zIndex:1040+Dialog.depth}}).inject(document.body),this.modal=new Element("div",{"class":"modal",events:{click:this.close.bind(this)},styles:{"max-width":"none",zIndex:1040+Dialog.depth+1}}).inject(document.body),Dialog.depth+=2,"auto"===this.options.width&&this.modal.setStyle("text-align","center");var e=new Element("div",{"class":this.options.dialog_class?"modal-dialog "+this.options.dialog_class:"modal-dialog"}).inject(this.modal);"auto"===this.options.width&&e.setStyles({display:"inline-block","text-align":"left",width:"auto"});var i=new Element("div",{"class":"modal-content",events:{click:function(t){t.stopPropagation()}}}).inject(e);if(this.options.styles&&i.setStyles(this.options.styles),this.options.title){var n=new Element("div",{"class":"modal-header"}).inject(i);this.options.show_close&&new Element("button",{"class":"close",html:"&times;",events:{click:this.close.bind(this)}}).inject(n),this.options.title&&new Element("h4",{html:this.options.title}).inject(n)}if(this.body=new Element("div",{"class":"modal-body"}).inject(i),this.options.footer||this.options.ok||this.options.cancel){if(this.footer=new Element("div",{"class":"modal-footer"}).inject(i),this.options.cancel&&this.add_cancel("string"==typeof this.options.cancel?this.options.cancel:"cancel"),this.options.ok){var s,o="ok";"object"==typeof this.options.ok&&(this.options.ok.text&&(o=this.options.ok.text),this.options.ok.click&&(s=this.options.ok.click)),s||(s=function(){var t=this.body.getElement("form");t?submit_form(t,{onComplete:this.ok.bind(this),validate:!0}):this.ok()}),this.add_ok(o,s)}this.options["delete"]&&this.add_delete(this.options["delete"])}if(this.options.component){var l=new Element("div",{id:"c_"}).inject(this.body);l.url=this.options.url,this.body=l}this.options.content&&this.body.set("html",this.options.content),this.options.url&&this.body.replace(this.options.url,{to_html:!0,on_complete:this.open.bind(this)})},add_cancel:function(t){new Element("button",{"class":"btn btn-default",text:t,events:{click:this.close.bind(this)}}).inject(this.footer)},add_delete:function(t){this["delete"]||(this["delete"]=new Element("button",{"class":"btn btn-danger",style:"float:left",text:"delete",events:{click:t.bind(this)}}).inject(this.footer))},add_ok:function(t,e){new Element("button",{"class":"btn btn-primary",text:t,events:{click:e.bind(this)}}).inject(this.footer)},close:function(){if(this.options.on_close&&this.options.on_close(),this.options.column){var t=context+"/Views/"+encodeURIComponent(this.options.db_view_def)+"/input?column="+encodeURIComponent(this.options.column);this.options.db_key_value&&(t+="&db_key_value="+this.options.db_key_value),$(this.options.column+"_row").getFirst().getNext().replace(t)}Dialog.stack.pop(),0===Dialog.stack.length&&rich_text_remove(this.body),this.modal.destroy(),new Fx.Tween(this.overlay,{onComplete:function(){this.overlay.destroy()}.bind(this)}).start("opacity",0),Dialog.depth-=2},ok:function(){this.options.reload_page&&(document.location=document.location),this.close(),this.options.owner&&this.options.owner.replace()},open:function(){this.options.rte&&!$(this.options.rte)&&delete this.options.rte,this.modal.setStyles({display:"block"})},rte:function(){var t=this.body.getElementById("cke_1_contents");t||this.rte.delay(200,this)}});Dialog.depth=0,Dialog.top=function(){return Dialog.stack&&0!==Dialog.stack.length?Dialog.stack[Dialog.stack.length-1]:null};var Dropdown=new Class({initialize:function(t,e){var i={margin:0,"min-width":0,padding:0,top:10};e&&(i.right=0,i.left="auto"),this.ul=new Element("ul",{"class":"dropdown-menu",styles:i}).inject(t),this.ul.store("object",this)},add:function(){for(var t=0;t<arguments.length;t+=2){var e=new Element("li").inject(this.ul);new Element("a",{href:"#",events:{click:arguments[t+1]},text:arguments[t]}).inject(e)}return this},show:function(){this.ul.setStyle("display","block"),Element.p=this.ul}}),Tabs=new Class({Implements:Options,options:{last_active:!1,show_close:!1,start_tab:null,use_cookie:!0},initialize:function(t,e,i){this.setOptions(i),t.tabs=this,this.id=t.id,this.options.use_cookie&&(this.cookie=cookie_get(this.id)),this.currentTab=null;var n=new Element("ul",{"class":"nav nav-tabs"}).inject(t,"top");if(e&&e.length>0){for(var s=t.getElement(".tab-content").getFirst(),o=0;o<e.length;o++)this.addTab(e[o],s),s=s.getNext();this.currentTab||(this.currentTab=this.options.start_tab?t.getFirst().getChildren()[e.indexOf(this.options.start_tab)]:this.options.last_active?t.getFirst().getLast():t.getFirst().getFirst()),this.currentTab.addClass("active").panel.setStyle("display","block")}},addTab:function(t,e){var i=$(this.id).getFirst(),n=this.newTab(t,e).inject(i);return this.options.use_cookie&&t===this.cookie&&(this.currentTab=n),n},closeTab:function(t){if(t||(t=this.currentTab),this.currentTab===t){var e=t.getNext();e||(e=t.getPrevious()),e&&this.show(e)}t.panel.dispose(),t.dispose()},newTab:function(t,e){var i=new Element("li"),n=new Element("a").set({href:"#",style:"cursor:pointer;",html:t}).inject(i);return this.options.show_close&&new Element("i",{"class":"glyphicon glyphicon-remove",events:{click:function(){var t=this.getParent().getParent(),e=t.getParent().getParent().tabs;return e.closeTab(t),!1}},styles:{marginLeft:5}}).inject(n),i.addEvent("click",this.show.bind(this,i)),e||(e=new Element("div",{"class":"tab-pane"}).inject($(this.id).getLast())),e.setStyle("visibility","visible"),i.panel=e,i},show:function(t){return this.currentTab&&this.currentTab.removeClass("active").panel.setStyle("display","none"),$(t).addClass("active").panel.setStyle("display","block"),this.currentTab=t,this.options.use_cookie&&cookie_set(this.id,t.firstChild.innerHTML,!0),!1}});